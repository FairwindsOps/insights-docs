(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{215:function(e,s,t){"use strict";t.r(s);var a=t(28),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"insights-agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#insights-agent"}},[e._v("#")]),e._v(" Insights Agent")]),e._v(" "),t("p",[e._v("The Insights Agent runs inside your Cluster, and sends back data to Fairwinds Insights.")]),e._v(" "),t("p",[e._v("The Insights Agent comes with several different open source reporting tools, each of which can be\nconfigured independently using Helm:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("workloads")]),e._v(" (required)")]),e._v(" "),t("li",[t("code",[e._v("polaris")])]),e._v(" "),t("li",[t("code",[e._v("goldilocks")])]),e._v(" "),t("li",[t("code",[e._v("trivy")])]),e._v(" "),t("li",[t("code",[e._v("kubesec")])]),e._v(" "),t("li",[t("code",[e._v("kubehunter")])]),e._v(" "),t("li",[t("code",[e._v("kubebench")])]),e._v(" "),t("li",[t("code",[e._v("releasewatcher")])]),e._v(" "),t("li",[t("code",[e._v("rbacreporter")])])]),e._v(" "),t("p",[e._v("To read more about the different report types, visit "),t("a",{attrs:{href:"./README"}},[e._v("the home page")])]),e._v(" "),t("h2",{attrs:{id:"configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),t("p",[e._v("The Insights Agent is installed and configured using Helm. To see the full list of options,\nyou can check out the\n"),t("a",{attrs:{href:"https://github.com/FairwindsOps/charts/tree/master/stable/insights-agent",target:"_blank",rel:"noopener noreferrer"}},[e._v("Insights Agent Helm chart"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("In particular, for any given report type, you can set the following options:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("enabled")]),e._v(" - this is typically set to "),t("code",[e._v("true")]),e._v(" by default")]),e._v(" "),t("li",[t("code",[e._v("schedule")]),e._v(" - a cron expression dictating when this plugin should run. This is typically set to a random minute every hour")]),e._v(" "),t("li",[t("code",[e._v("timeout")]),e._v(" - how long to wait for output, in seconds")]),e._v(" "),t("li",[t("code",[e._v("resources")]),e._v(" - requests and limits for CPU and memory for this plugin")])]),e._v(" "),t("h2",{attrs:{id:"debugging"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#debugging"}},[e._v("#")]),e._v(" Debugging")]),e._v(" "),t("p",[e._v("If you suspect something is wrong with the Insights Agent, you can use "),t("code",[e._v("kubectl")]),e._v(" to\ndebug the problem.")]),e._v(" "),t("p",[e._v("After the agent runs, "),t("code",[e._v("kubectl get pods")]),e._v(" should show something like this:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ kubectl get pods -n insights-agent\nNAME                                                    READY   STATUS      RESTARTS   AGE\ngoldilocks-5sh8s                                        0/2     Completed   0          18m\ngoldilocks-7pgp6                                        0/2     Completed   0          19m\ninsights-agent-goldilocks-controller-5b6b45d678-vgbrk   1/1     Running     0          19m\ninsights-agent-goldilocks-vpa-install-566h8             0/1     Completed   0          19m\nkube-bench-dpvbz                                        0/2     Completed   0          18m\nkube-hunter-tnmsw                                       0/2     Completed   0          18m\npolaris-zk4px                                           0/2     Completed   0          18m\nrbac-reporter-1583952600-kwmfz                          0/2     Completed   0          105s\nrbac-reporter-sf9cz                                     0/2     Completed   0          18m\nrelease-watcher-6lhm7                                   0/2     Completed   0          18m\ntrivy-8nw9d                                             0/2     Completed   0          18m\nworkloads-1583951700-dj6wb                              0/2     Completed   0          16m\nworkloads-q6gzt                                         0/2     Completed   0          18m\n")])])]),t("p",[e._v("If any of the pods there show an error, you can look at the logs. There are typically two containers\nper pod in the Insights Agent - one to run the auditing tool, and another to upload the results.\nFor example, here are typical logs for kube-bench:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ kubectl logs kube-bench-dpvbz -n insights-agent -c kube-bench\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2020-03-11T18:32:51Z"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("info "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("msg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Starting:"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2020-03-11T18:32:51Z"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("info "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("msg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Updating data."')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2020-03-11T18:32:54Z"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("info "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("msg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Data updated."')]),e._v("\n")])])]),t("p",[e._v("If nothing suspicious appears there, you might find an answer in the second container, which uploads the results.\nIt should end with something like this:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ kubectl logs kube-bench-dpvbz -n insights-agent -c insights-uploader\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -X POST https://staging.insights.fairwinds.com/v0/organizations/acme-co/clusters/staging/data/kube-bench -L -d @/output/kube-bench.json -H "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Authorization: Bearer <REDACTED>'")]),e._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Content-Type: application/json'")]),e._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'X-Fairwinds-Agent-Version: 0.1.3'")]),e._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'X-Fairwinds-Report-Version: 0.1'")]),e._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'X-Fairwinds-Agent-Chart-Version: 0.15.2'")]),e._v(" --fail\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("  174k  "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16")]),e._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("  174k     "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("23")]),e._v("   254k --:--:-- --:--:-- --:--:--  274k\n+ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Success"')]),e._v(":true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h3",{attrs:{id:"common-problems"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#common-problems"}},[e._v("#")]),e._v(" Common Problems")]),e._v(" "),t("h4",{attrs:{id:"resource-limits"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resource-limits"}},[e._v("#")]),e._v(" Resource Limits")]),e._v(" "),t("p",[e._v("We have set reasonable resource requests and limits on each of the audits, but some clusters\nmay push the boundaries of our assumptions. If you're seeing out-of-memory errors or other\nresource-related issues, try setting higher resource limits.")]),e._v(" "),t("p",[e._v("If you're using the helm chart, you can do this by adding")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("--set "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$reportType")]),e._v(".resources.limits.memory"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("1G\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# or")]),e._v("\n--set "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$reportType")]),e._v(".resources.limits.cpu"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("1000m\n")])])]),t("p",[e._v("to your "),t("code",[e._v("helm update --install")]),e._v(" command.")]),e._v(" "),t("h4",{attrs:{id:"timeouts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timeouts"}},[e._v("#")]),e._v(" Timeouts")]),e._v(" "),t("p",[e._v("We have set a reasonable timeout for each of the audits, but again, some clusters may\npush the boundaries of our assumptions. If you're seeing timeout issues in the "),t("code",[e._v("insights-uploader")]),e._v("\ncontainer in one of the report types, you can adjust the timeout by adding:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("--set "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$reportType")]),e._v(".timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3600")]),e._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 3600s = 5min")]),e._v("\n")])])]),t("p",[e._v("to your "),t("code",[e._v("helm update --install")]),e._v(" command.")])])}),[],!1,null,null,null);s.default=n.exports}}]);