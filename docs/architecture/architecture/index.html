<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Insights Architecture | Fairwinds Insights Documentation</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="Documentation for the Fairwinds Insights Kubernetes auditing platform">
    <link rel="preload" href="/assets/css/0.styles.ba7d046e.css" as="style"><link rel="preload" href="/assets/js/app.6607c262.js" as="script"><link rel="preload" href="/assets/js/2.d0aaf875.js" as="script"><link rel="preload" href="/assets/js/12.b8f74e49.js" as="script"><link rel="prefetch" href="/assets/js/10.95e8994a.js"><link rel="prefetch" href="/assets/js/11.94fbe278.js"><link rel="prefetch" href="/assets/js/13.417d7acf.js"><link rel="prefetch" href="/assets/js/14.d4ef333c.js"><link rel="prefetch" href="/assets/js/15.a1e203fe.js"><link rel="prefetch" href="/assets/js/16.750dd917.js"><link rel="prefetch" href="/assets/js/17.316152b0.js"><link rel="prefetch" href="/assets/js/18.7ee0f4d2.js"><link rel="prefetch" href="/assets/js/19.47aefea7.js"><link rel="prefetch" href="/assets/js/20.cd57ed54.js"><link rel="prefetch" href="/assets/js/21.61262dc5.js"><link rel="prefetch" href="/assets/js/22.1aa57b13.js"><link rel="prefetch" href="/assets/js/23.640f52f1.js"><link rel="prefetch" href="/assets/js/24.bb59abb9.js"><link rel="prefetch" href="/assets/js/25.f5c19b84.js"><link rel="prefetch" href="/assets/js/26.d81f4a37.js"><link rel="prefetch" href="/assets/js/27.0a40f8a5.js"><link rel="prefetch" href="/assets/js/28.adfc77fa.js"><link rel="prefetch" href="/assets/js/29.6be13fe8.js"><link rel="prefetch" href="/assets/js/3.f462631d.js"><link rel="prefetch" href="/assets/js/30.1d0adafc.js"><link rel="prefetch" href="/assets/js/31.19ac4b15.js"><link rel="prefetch" href="/assets/js/32.e0b8fbaa.js"><link rel="prefetch" href="/assets/js/33.5949d733.js"><link rel="prefetch" href="/assets/js/34.fae70ab4.js"><link rel="prefetch" href="/assets/js/35.577dcdb6.js"><link rel="prefetch" href="/assets/js/36.c0efb854.js"><link rel="prefetch" href="/assets/js/37.8a25211f.js"><link rel="prefetch" href="/assets/js/38.bb0108cf.js"><link rel="prefetch" href="/assets/js/39.8c1adaa8.js"><link rel="prefetch" href="/assets/js/4.3b6a7e49.js"><link rel="prefetch" href="/assets/js/40.35017e26.js"><link rel="prefetch" href="/assets/js/41.3514adf1.js"><link rel="prefetch" href="/assets/js/42.bd82a5a1.js"><link rel="prefetch" href="/assets/js/43.5fb7b069.js"><link rel="prefetch" href="/assets/js/44.c3a62841.js"><link rel="prefetch" href="/assets/js/45.681ea190.js"><link rel="prefetch" href="/assets/js/46.cbbb5c07.js"><link rel="prefetch" href="/assets/js/5.c03b1cde.js"><link rel="prefetch" href="/assets/js/6.7c1f35f3.js"><link rel="prefetch" href="/assets/js/7.d26a1be5.js"><link rel="prefetch" href="/assets/js/8.72bdfd08.js"><link rel="prefetch" href="/assets/js/9.9665c39f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ba7d046e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.svg" alt="Fairwinds Insights Documentation" class="logo"> <span class="site-name can-hide">Fairwinds Insights Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/release-notes/" class="sidebar-link">Release Notes</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Installation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/installation/getting-started/" class="sidebar-link">Getting Started</a></li><li><a href="/installation/report-hub/" class="sidebar-link">Report Hub</a></li><li><a href="/installation/insights-agent/" class="sidebar-link">Insights Agent</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>First Steps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Features</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reports</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integrations</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Management</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API Access</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Architecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/architecture/" aria-current="page" class="active sidebar-link">Insights Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architecture/architecture/#network-egress" class="sidebar-link">Network Egress</a></li><li class="sidebar-sub-header"><a href="/architecture/architecture/#report-architectures" class="sidebar-link">Report Architectures</a></li><li class="sidebar-sub-header"><a href="/architecture/architecture/#rbac-requirements" class="sidebar-link">RBAC requirements</a></li></ul></li><li><a href="/architecture/sample-reports/" class="sidebar-link">Sample Reports</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="insights-architecture"><a href="#insights-architecture" class="header-anchor">#</a> Insights Architecture</h1> <p>Fairwinds Insights consists of two main components:</p> <ul><li>The Client - this consists of the users's cluster, where the Insights Agent runs each of the enabled reports</li> <li>The Server - this consists of the Insights backend, database, and file storage</li></ul> <img src="/img/architecture.png" alt="Insights Architecture"> <p>While each report has its own requirements, there are some baseline requirements needed by the
Insights Agent:</p> <ul><li>Sufficient RBAC permissions to create new Jobs in the cluster</li> <li>The <code>view</code> ClusterRole</li> <li>Network access to <code>insights.fairwinds.com</code></li></ul> <p>Additional architecture notes and RBAC requirements for different reports are listed below.
Note that the Insights Agent only requires <em>egress</em> from the cluster - you will not need to
open up access for any kind of network ingress.</p> <h2 id="network-egress"><a href="#network-egress" class="header-anchor">#</a> Network Egress</h2> <p>Fairwinds Insights will need access to the following domains:</p> <ul><li>insights.fairwinds.com</li> <li>quay.io</li> <li>hub.docker.com (kube-hunter)</li> <li>raw.githubusercontent.com (goldilocks)</li> <li>github.com (trivy)</li> <li>github-production-release-asset-*.s3.amazonaws.com (trivy)</li></ul> <h2 id="report-architectures"><a href="#report-architectures" class="header-anchor">#</a> Report Architectures</h2> <p>Typically, each report runs as a CronJob on a configurable schedule (usually once/hour by default).
The report will analyze resources in the cluster, then send a JSON report with its findings
to <code>insights.fairwinds.com</code>.</p> <p>Any exceptions or additions to this flow are listed below.</p> <h3 id="goldilocks"><a href="#goldilocks" class="header-anchor">#</a> Goldilocks</h3> <p>In addition to the typical cronjob, Goldilocks will run a long-lived Deployment for controlling
VPA objects. Goldilocks will add a VPA (in <code>recommend</code> mode) to any incoming Deployment in order to
provide resource recommendations.</p> <p>Goldilocks needs access to <code>raw.githubusercontent.com</code> in order to access the CRDs for VPA objects,
which will be installed in the cluster alongside the Insights Agent.</p> <p>Goldilocks also requires a metrics-server installation.</p> <h3 id="kube-bench"><a href="#kube-bench" class="header-anchor">#</a> kube-bench</h3> <p>kube-bench can run in one of two modes:</p> <ul><li><code>cronjob</code> (default) - this runs the report for a single node</li> <li><code>daemonset</code> - this runs the report on all nodes</li></ul> <p>If your nodes are homogenous (i.e. you only have a single node pool), the <code>cronjob</code> mode
is sufficient. But if your nodes have different configurations, you'll likely want to run
kube-bench as a DaemonSet.</p> <p>kube-bench needs access to some resources on the node in order to perform its audit, including:</p> <ul><li><code>/var/lib</code></li> <li><code>/etc/systemd</code></li> <li><code>/etc/kubernetes</code></li> <li><code>/usr/local/mount-from-host/bin</code></li> <li>root access</li></ul> <h3 id="kube-hunter"><a href="#kube-hunter" class="header-anchor">#</a> kube-hunter</h3> <p>kube-hunter runs in <a href="https://github.com/aquasecurity/kube-hunter#pod" target="_blank" rel="noopener noreferrer">pod mode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in order to discover what
running a malicious container can do/discover on your cluster.</p> <h3 id="kubesec"><a href="#kubesec" class="header-anchor">#</a> kubesec</h3> <p>kubesec only needs <code>view</code> access to the cluster in order to analyze workloads for misconfigurations.</p> <h3 id="nova"><a href="#nova" class="header-anchor">#</a> Nova</h3> <p>Nova needs access to <code>Secrets</code>, which contain metadata about installed Helm charts.</p> <p>Nova will also need network access to any third-party Helm repositories from which Helm charts have
been installed (e.g. <code>https://kubernetes-charts.storage.googleapis.com</code>).</p> <p>Nova will find all Helm charts installed in the cluster, then cross-check those charts with the upstream
repositories to check for new versions.</p> <h3 id="opa"><a href="#opa" class="header-anchor">#</a> OPA</h3> <p>The OPA report will reach out to the Insights API to pull down any Rego policies that have been added to your
organization. It will need <code>view</code> access to the cluster in order to run those policies against existing resources.</p> <h3 id="pluto"><a href="#pluto" class="header-anchor">#</a> Pluto</h3> <p>Pluto needs <code>view</code> access to the cluster in order to check for deprecated API versions.</p> <h3 id="polaris"><a href="#polaris" class="header-anchor">#</a> Polaris</h3> <p>Polaris needs <code>view</code> access to the cluster in order to analyze workload configurations. It also needs
access to Secrets in order to examine Helm charts.</p> <h3 id="rbac-reporter"><a href="#rbac-reporter" class="header-anchor">#</a> RBAC Reporter</h3> <p>RBAC Reporter needs <code>view</code> access to the cluster to aggregate information about RBAC roles and bindings.</p> <h3 id="trivy"><a href="#trivy" class="header-anchor">#</a> Trivy</h3> <p>Trivy will download a list of known CVEs <a href="https://github.com/aquasecurity/trivy-db" target="_blank" rel="noopener noreferrer">from GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
then cross-check these against images in your cluster.</p> <p>You may need to grant Trivy access to <a href="/reports/trivy#private-images">private images</a> if your nodes
don't automatically have access to your private Docker registries.</p> <h3 id="workloads"><a href="#workloads" class="header-anchor">#</a> Workloads</h3> <p>The Workloads report only needs <code>view</code> access to your cluster.</p> <h2 id="rbac-requirements"><a href="#rbac-requirements" class="header-anchor">#</a> RBAC requirements</h2> <p>Each Fairwinds Insights plugin requires a unique set of permissions in order to do its job.
Here we provide a list of permissions requested by each plugin - you can also review
the <a href="https://github.com/FairwindsOps/charts/tree/master/stable/insights-agent" target="_blank" rel="noopener noreferrer">helm chart<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to
see the exact RBAC configurations for each plugin.</p> <p>Notably, some plugins require <strong>read access to secrets</strong>. This is because they examine Helm 3
releases, which store metadata inside of a <code>Secret</code> object.</p> <p>If a particular plugin requires permissions that you're uncomfortable with, you can disable it
in the Helm chart by adding <code>--set $plugin.enabled=false</code>.</p> <h3 id="permission-list"><a href="#permission-list" class="header-anchor">#</a> Permission List</h3> <table><thead><tr><th>Plugin</th> <th style="text-align:center;">View Secrets</th> <th style="text-align:center;">View Resources (non-secrets)</th> <th>Other/Notes</th></tr></thead> <tbody><tr><td>kube-bench</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td></td></tr> <tr><td>kube-hunter</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td></td></tr> <tr><td>Polaris</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td></td></tr> <tr><td>Kubesec</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td></td></tr> <tr><td>RBAC reporter</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td></td></tr> <tr><td>Trivy</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td></td></tr> <tr><td>Workloads</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td></td></tr> <tr><td>Goldilocks</td> <td style="text-align:center;"></td> <td style="text-align:center;">✅</td> <td>Create/Delete VPAs</td></tr> <tr><td>Release Watcher</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td>Needs secrets to view Helm releases</td></tr> <tr><td>Pluto</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td>Needs secrets to view Helm releases</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/FairwindsOps/insights-docs/edit/master/architecture/architecture.md" target="_blank" rel="noopener noreferrer">Help us improve this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/custom-reports/" class="prev">
        Custom Reports API
      </a></span> <span class="next"><a href="/architecture/sample-reports/">
        Sample Reports
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6607c262.js" defer></script><script src="/assets/js/2.d0aaf875.js" defer></script><script src="/assets/js/12.b8f74e49.js" defer></script>
  </body>
</html>
